<cruisecontrol>
    <system>
        <configuration>
            <threads count="5" />
        </configuration>
    </system>

    <property name="root.dir" value="/CruiseControl" />
    <property name="ccdir" value="${root.dir}/2.7.1"/>
    <property name="ccport" value="8080"/>
    <property name="servername" value="lklinux02.fhcrc.org"/>
    <property name="tomcat.home" value="${root.dir}/tomcat/${instance}" />
    <property name="projectdir" value="${root.dir}/enlistments/${instance}"/>
    <property name="reportdir" value="${ccdir}/reporting"/>
    <property name="artifactsdir" value="${ccdir}/artifacts/${project.name}"/>
    <property name="logdir" value="${ccdir}/logs/${project.name}"/>
    
    <property name="testdir" value="${projectdir}/server/test"/>
    <property name="antbuildfile" value="${projectdir}/server/build.xml"/>
    <property name="antworkingdir" value="${projectdir}/server"/>
    <property name="anthome" value="${projectdir}/external/ant"/>

    <!-- Defaults for email -->
    <property name="buildmaster.email" value="brittp@labkey.com"/>
    <property name="buildmaster.name" value="Buildmaster"/>

    <!-- Preconfigure our plugins -->
    <plugin name="log"
            dir="${logdir}"/>

    <plugin name="currentbuildstatuslistener"
            file="${logdir}/status.txt"/>

    <plugin name="svn"
            localworkingcopy="${projectdir}"
            username="${svnuser}"
            password="${svnpassword}"/>

    <plugin name="svnbootstrapper"
            username="${svnuser}"
            password="${svnpassword}"
            localWorkingCopy="${projectdir}"/>

    <plugin name="ant"
            antHome="${anthome}"
            antWorkingDir="${antworkingdir}"
            buildfile="${antbuildfile}"
            timeout="9000"
            uselogger="true"
            saveLogDir="${ccdir}/output" />

    <plugin name="htmlemail"
            defaultsuffix="@fhcrc.org"
            buildresultsurl="http://${servername}:${ccport}/cruisecontrol/buildresults/${project.name}"
            mailhost="localhost"
            returnaddress="${buildmaster.email}"
            returnname="${buildmaster.name}"
            subjectprefix="[CC] Linux/Postgres"
            xsldir="${ccdir}/webapps/cruisecontrol/xsl"
            css="${ccdir}/webapps/cruisecontrol/css/cruisecontrol.css">
        <!-- Special-case peterhus, since his SVN username doesn't include '@labkey.com' -->
        <map alias="peterhus" address="peterhus@labkey.com" />
        <map alias="e.ulberg" address="ulberge@labkey.com" />
        <map alias="migra@fhcrc.org" address="marki@labkey.com" />
        <map alias="arauch" address="adam@labkey.com" />
        <map alias="mbellew" address="matthewb@labkey.com" />
        <map alias="e.nelson" address="eknelson@labkey.com" />
        <map alias="b.connolly" address="bconn@labkey.com" />
        <map alias="d.stearns" address="daves@labkey.com" />
        <map alias="k.krouse" address="kevink@labkey.com" />
        <map alias="j.garms" address="jgarms@labkey.com" />
        <always address="${buildmaster.email}"/>
        <failure reportWhenFixed="true" address="cpas-developers@lists.fhcrc.org"/>
        <parameter name="lineCount" value="250" />
    </plugin>

    <plugin name="artifactspublisher"
            dir="${testdir}/build/logs"
            dest="${artifactsdir}" />

    <plugin name="project.labkey" classname="net.sourceforge.cruisecontrol.ProjectConfig">
        <listeners>
            <currentbuildstatuslistener/>
        </listeners>
        <bootstrappers>
            <svnbootstrapper username="cpas"
                             password="cpas"/>
        </bootstrappers>
        <modificationset quietperiod="180">
            <svn username="cpas"
                password="cpas" />
        </modificationset>
        <schedule>
            <ant target="cruisecontrol2">
                <property name="cc.tomcat.home" value="${tomcat.home}"/>
                <property name="cc.tomcat.port" value="${tomcatport}"/>
                <property name="cc.suite" value="${suite}"/>
                <property name="cc.debug.port" value="${debugport}"/>
                <property name="cc.selenium.port" value="${seleniumport}"/>
                <property name="cc.linkCheck" value="${linkCheck}"/>
                <property name="cc.database" value="${database}"/>
            </ant>
        </schedule>
        <publishers>
            <htmlemail/>
            <artifactspublisher/>
        </publishers>
    </plugin>

    <project.labkey name="Trunk BVT" buildafterfailed="false">
        <property name="instance" value="trunk"/>
        <property name="tomcatport" value="8090"/>
        <property name="debugport" value="5555"/>
        <property name="seleniumport" value="4445"/>
        <property name="suite" value="BVT"/>
        <property name="linkCheck" value="true"/>
        <property name="database" value="postgres"/>
    </project.labkey>


    <project.labkey name="Branch BVT" buildafterfailed="false">
        <property name="instance" value="branch"/>
        <property name="tomcatport" value="8085"/>
        <property name="debugport" value="5556"/>
        <property name="seleniumport" value="4446"/>
        <property name="suite" value="BVT"/>
        <property name="linkCheck" value="true"/>
        <property name="database" value="postgres"/>
    </project.labkey>
</cruisecontrol>