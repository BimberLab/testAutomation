<ApiTests xmlns="http://labkey.org/query/xml">
    <test name="${Role} - ${QCState}" type="post">
        <url>
            <![CDATA[query/WNPRC/EHR/saveRows.view]]></url>
        <formData>
            {"commands":
            [{
                "schemaName":"study",
                "queryName":"Weight",
                "command":"insertWithKeys",
                "rows":
                [{
                    "values":
                    {
                        "Id":"${AnimalId}",
                        "date":"2011-05-12T13:01:00",
                        "enddate":null,
                        "project":null,
                        "account":null,
                        "weight":22,
                        "remark":null,
                        "performedby":null,
                        "QCStateLabel":"${QCState}",
                        "lsid":null,
                        "objectid":null,
                        "parentId":null,
                        "taskid":"237539ae-5e39-102e-a19e-7a684b53aa87",
                        "requestid":null,
                        "_recordId":"ext-record-195"
                    },
                    "oldKeys":
                    {
                        "lsid":"ext-record-195"
                    }
                }],
                "extraContext":
                {
                    "storeId":"study||Weight||||",
                    "queryName":"Weight",
                    "schemaName":"study",
                    "keyField":"lsid"
                }
            }],
            "extraContext":
            {
                "silent":true,
                "targetQCState":null,
                "errorThreshold":"WARN",
                "skipIdFormatCheck":true
            }}
        </formData>
        <successresponse>
           {"result": [{
                "containerPath": "/WNPRC/EHR",
                "rowsAffected": 1,
                "schemaName": "study",
                "queryName": "Weight",
                "command": "insertWithKeys",
                "rows": [{
                    "values": {
                        "weight": 22,
                        "ts": null,
                        "Dataset": null,
                        "remark": null,
                        "taskid": "237539ae-5e39-102e-a19e-7a684b53aa87",
                        "SequenceNum": null,
                        "date": "12 May 2011 13:01:00",
                        "ParticipantSequenceKey": null,
                        "parentId": null,
                        "Created": null,
                        "weightRawValue": null,
                        "Modified": null,
                        "performedby": null,
                        "QCState": 22,
                        "sourcelsid": null,
                        "lsid": "urn:lsid:labkey.com:Study.Data-33:1045.2.0110512E7.1052976.26e8080a-5fb5-102e-b27b-fe05e4821f99",
                        "Description": "Weight: 22",
                        "weightMVIndicator": null,
                        "ModifiedBy": null,
                        "project": null,
                        "CreatedBy": null,
                        "account": null,
                        "Id": "${AnimalId}",
                        "requestid": null,
                        "objectid": "26e8080a-5fb5-102e-b27b-fe05e4821f99",
                        "_row": null
                    },
                    "oldKeys": {"lsid": "ext-record-195"}
                }]
            }]}
        </successresponse>
        <failresponse>
            {
                "exceptionClass": "org.labkey.api.util.UnexpectedException",
                "exception": "com.sun.phobos.script.util.ExtendedScriptException: org.mozilla.javascript.JavaScriptException: This user does not have insert privledges for the table: Weight (scripts/ehr/validation.js#662) in scripts/ehr/validation.js at line number 662",
                "stackTrace": [
                    "org.labkey.api.data.AbstractTableInfo.invokeTableScript(AbstractTableInfo.java:894)",
                    "org.labkey.api.data.AbstractTableInfo.fireRowTrigger(AbstractTableInfo.java:951)",
                    "org.labkey.api.query.AbstractQueryUpdateService.insertRows(AbstractQueryUpdateService.java:99)",
                    "org.labkey.study.query.DatasetUpdateService.insertRows(DatasetUpdateService.java:67)",
                    "org.labkey.query.controllers.QueryController$CommandType$2.saveRows(QueryController.java:2542)",
                    "org.labkey.query.controllers.QueryController$BaseSaveRowsAction.executeJson(QueryController.java:2685)",
                    "org.labkey.query.controllers.QueryController$SaveRowsAction.execute(QueryController.java:2828)",
                    "org.labkey.query.controllers.QueryController$SaveRowsAction.execute(QueryController.java:2764)",
                    "org.labkey.api.action.ApiAction.handlePost(ApiAction.java:146)",
                    "org.labkey.api.action.ApiAction.handleRequest(ApiAction.java:97)",
                    "org.labkey.api.action.BaseViewAction.handleRequestInternal(BaseViewAction.java:166)",
                    "org.springframework.web.servlet.mvc.AbstractController.handleRequest(AbstractController.java:153)",
                    "org.labkey.api.action.SpringActionController.handleRequest(SpringActionController.java:348)",
                    "org.labkey.api.module.DefaultModule.dispatch(DefaultModule.java:756)",
                    "org.labkey.api.view.ViewServlet.service(ViewServlet.java:164)",
                    "javax.servlet.http.HttpServlet.service(HttpServlet.java:717)",
                    "org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)",
                    "org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)",
                    "org.labkey.api.data.TransactionFilter.doFilter(TransactionFilter.java:36)",
                    "org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)",
                    "org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)",
                    "org.labkey.core.filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:118)",
                    "org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)",
                    "org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)",
                    "org.labkey.api.module.ModuleLoader.doFilter(ModuleLoader.java:609)",
                    "org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)",
                    "org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)",
                    "org.labkey.api.security.AuthFilter.doFilter(AuthFilter.java:143)",
                    "org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)",
                    "org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)",
                    "org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)",
                    "org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)",
                    "org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)",
                    "org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)",
                    "org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)",
                    "org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)",
                    "org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:859)",
                    "org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)",
                    "org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)",
                    "java.lang.Thread.run(Thread.java:619)"
                ]
            }
        </failresponse>
    </test>
</ApiTests>

